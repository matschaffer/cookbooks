define contact {
  contact_name                    root
  alias                           Root
  service_notification_period     24x7
  host_notification_period        24x7
  service_notification_options    w,u,c,r
  host_notification_options       d,r
  service_notification_commands   service-notify-by-email
  host_notification_commands      host-notify-by-email
  email                           <%= node[:nagios][:sysadmin_email] %>
}

<% @groups.each do |grp| %>
define contactgroup {
  contactgroup_name <%= grp %>
}

define contactgroup {
  contactgroup_name <%= grp %>-sms
}
<% end %>

<% @contacts.each do |c| %>
define contact {
  contact_name <%= c['id'] %>
  email        <%= c['email'] %>
  use          default-contact
  contactgroups <%= c[:groups].join(',') %>
}
<% if c.has_key?('pager') and node[:nagios].has_key?(:sms) %>
define contact {
  contact_name <%= c['id'] %>-sms
  email        <%= c['email'] %>
  pager        <%= c['pager'] %>
  use          sms-contact
  contactgroups <%= c[:groups].map{|g| g + '-sms'}.join(',') %>
}
<% end %>

<% end %>


